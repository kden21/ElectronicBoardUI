{"ast":null,"code":"import _asyncToGenerator from \"K:/Coding/SolarLab/TechnicalTask/UI/Angular/ElectronicBoardUI/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"@angular/common/http\";\nimport * as i2 from \"./user.service\";\nexport class AuthService {\n  constructor(http, userService) {\n    this.http = http;\n    this.userService = userService;\n  } //todo:переделать тип возвращаемого объекта\n\n\n  login(account) {\n    var _this = this;\n\n    return _asyncToGenerator(function* () {\n      yield _this.http.post('https://localhost:7097/v1/account/login', account).subscribe(jwt => {\n        if (jwt.userId !== undefined) {\n          _this.userService.getById(jwt.userId).subscribe(user => {\n            user.token = jwt.jwtToken;\n            localStorage.setItem('user', JSON.stringify(user));\n          });\n        }\n      });\n    })();\n  }\n\n  register(account) {\n    return this.http.post('https://localhost:7097/v1/account/register', account);\n  }\n\n}\n\nAuthService.ɵfac = function AuthService_Factory(t) {\n  return new (t || AuthService)(i0.ɵɵinject(i1.HttpClient), i0.ɵɵinject(i2.UserService));\n};\n\nAuthService.ɵprov = /*@__PURE__*/i0.ɵɵdefineInjectable({\n  token: AuthService,\n  factory: AuthService.ɵfac,\n  providedIn: 'root'\n});","map":{"version":3,"mappings":";;;;AAcA,OAAM,MAAOA,WAAP,CAAkB;EAEtBC,YAAoBC,IAApB,EAA8CC,WAA9C,EAAqE;IAAjD;IAA0B;EAC7C,CAHqB,CAIxB;;;EACQC,KAAK,CAACC,OAAD,EAAiB;IAAA;;IAAA;MAC1B,MAAM,KAAI,CAACH,IAAL,CAAUI,IAAV,CAA+B,yCAA/B,EAA0ED,OAA1E,EAAmFE,SAAnF,CAA6FC,GAAG,IAAE;QACtG,IAAIA,GAAG,CAACC,MAAJ,KAAeC,SAAnB,EAA6B;UAC3B,KAAI,CAACP,WAAL,CAAiBQ,OAAjB,CAAyBH,GAAG,CAACC,MAA7B,EAAqCF,SAArC,CAAgDK,IAAI,IAAG;YACrDA,IAAI,CAACC,KAAL,GAAaL,GAAG,CAACM,QAAjB;YACAC,YAAY,CAACC,OAAb,CAAqB,MAArB,EAA6BC,IAAI,CAACC,SAAL,CAAeN,IAAf,CAA7B;UACD,CAHD;QAID;MACF,CAPK,CAAN;IAD0B;EAS3B;;EAEDO,QAAQ,CAACd,OAAD,EAAiB;IACvB,OAAO,KAAKH,IAAL,CAAUI,IAAV,CAAyB,4CAAzB,EAAuED,OAAvE,CAAP;EACD;;AAlBqB;;;mBAAXL,aAAWoB;AAAA;;;SAAXpB;EAAWqB,SAAXrB,WAAW;EAAAsB,YAJV","names":["AuthService","constructor","http","userService","login","account","post","subscribe","jwt","userId","undefined","getById","user","token","jwtToken","localStorage","setItem","JSON","stringify","register","i0","factory","providedIn"],"sourceRoot":"","sources":["K:\\Coding\\SolarLab\\TechnicalTask\\UI\\Angular\\ElectronicBoardUI\\src\\app\\services\\auth.service.ts"],"sourcesContent":["import {HttpClient} from \"@angular/common/http\";\r\nimport {Observable} from \"rxjs\";\r\nimport {Injectable} from \"@angular/core\";\r\nimport {IAccount} from \"../models/account\";\r\nimport {UserService} from \"./user.service\";\r\nimport {IUser} from \"../models/user\";\r\nimport {IAdvt} from \"../models/advt\";\r\nimport {ILoginResponse} from \"../models/loginResponse\";\r\n\r\n@Injectable({\r\n  providedIn: 'root'\r\n})\r\n\r\n\r\nexport class AuthService{\r\n\r\n  constructor(private http: HttpClient, private userService:UserService) {\r\n  }\r\n//todo:переделать тип возвращаемого объекта\r\n  async login(account:IAccount){\r\n    await this.http.post<ILoginResponse>('https://localhost:7097/v1/account/login', account).subscribe(jwt=> {\r\n      if (jwt.userId !== undefined){\r\n        this.userService.getById(jwt.userId).subscribe( user => {\r\n          user.token = jwt.jwtToken;\r\n          localStorage.setItem('user', JSON.stringify(user));\r\n        });\r\n      }\r\n    });\r\n  }\r\n\r\n  register(account:IAccount): Observable<IAccount>{\r\n    return this.http.post<IAccount>('https://localhost:7097/v1/account/register', account);\r\n  }\r\n}\r\n"]},"metadata":{},"sourceType":"module"}